# This workflow is not recommended to be used. Reason is, it creates another automated workflow to deploy the test results to GitHub Pages. Which means the results URL is not in context with the pipeline that runs the test. Thus this is for educations purposes only.
# Reference: https://docs.github.com/en/pages/getting-started-with-github-pages/configuring-a-publishing-source-for-your-github-pages-site#publishing-from-a-branch
name: Test and Publish test results to GitHub Pages
on:
  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# Required to deploy to GitHub Pages 
permissions: 
    contents: write

jobs:
  playwright:
    name: 'Playwright Tests'
    runs-on: ubuntu-latest
    container:
      image: mcr.microsoft.com/playwright:v1.41.1-jammy
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-node@v4
        with:
          node-version: 18

      - name: Install dependencies
        run: npm ci

      - name: Run Playwright tests
        run: npx playwright test
        env:
          HOME: /root

      - uses: actions/upload-artifact@v4
        if: always()
        with:
            name: playwright-report
            path: playwright-report/
            retention-days: 30
           
      - name: Deploy to GitHub Pages
        uses: crazy-max/ghaction-github-pages@v4
        with:
            target_branch: gh-pages
            build_dir: playwright-report
        env:
            GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}